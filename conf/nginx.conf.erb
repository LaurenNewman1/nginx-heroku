worker_processes  1;
daemon off;

events {
	worker_connections  1024;
}

http {
	include       mime.types;
	default_type  application/octet-stream;

	sendfile        on;

	keepalive_timeout  65;

	server {
		listen       <%= ENV['PORT'] %>;
		server_name  localhost;

		location / {
			root   html;
			index  index.html index.htm;
		}
		
		location /natcon/ {
			proxy_pass http://natcon.bahai.us/;
			subs_filter_types text/html text/css text/xml;
			subs_filter '</body>' '<script src="https://my.bahai.us/media/js/myproxy/mybahai.js"></script><script src="https://my.bahai.us/media/js/myproxy/9.js"></script></body>';
			subs_filter 'http://fund.bahai.us/' '/fund/';
		}
		
		location /fund/ {
			proxy_pass http://fund.bahai.us/;
			subs_filter_types text/html text/css text/xml;
			subs_filter '</body>' '<script src="https://my.bahai.us/media/js/myproxy/mybahai.js"></script><script src="https://my.bahai.us/media/js/myproxy/9.js"></script></body>';
			subs_filter 'http://fund.bahai.us/' '/fund/';
        }

        #error_page  404              /404.html;

		error_page   500 502 503 504  /50x.html;
		location = /50x.html {
			root   html;
		}
	}
}
